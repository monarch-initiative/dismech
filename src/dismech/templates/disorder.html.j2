<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ disorder.name }} - Disorder Mechanisms</title>
    <style>
        :root {
            --primary: #0f766e;
            --primary-light: #14b8a6;
            --primary-dark: #0d5c56;
            --secondary: #6366f1;
            --bg: #f0fdfa;
            --card-bg: #ffffff;
            --text: #134e4a;
            --text-muted: #5f7a78;
            --border: #ccfbf1;
            --accent-orange: #f59e0b;
            --accent-rose: #f43f5e;
            --accent-violet: #8b5cf6;
            --accent-sky: #0ea5e9;
            --banner-bg: #fef3c7;
            --banner-border: #f59e0b;
            --banner-text: #92400e;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.7;
        }

        .notice-banner {
            background: var(--banner-bg);
            color: var(--banner-text);
            border-bottom: 1px solid var(--banner-border);
            padding: 12px 16px;
            text-align: center;
            font-size: 0.95rem;
            cursor: pointer;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 24px;
        }

        /* Header */
        .page-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 40px 32px;
            border-radius: 16px;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }

        .page-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 400px;
            height: 400px;
            background: rgba(255,255,255,0.05);
            border-radius: 50%;
        }

        .page-header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 12px;
            position: relative;
        }

        .header-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
            position: relative;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .badge-category {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .badge-mondo {
            background: var(--accent-sky);
            color: white;
        }

        .badge-mondo a {
            color: inherit;
            text-decoration: none;
        }

        .badge-mondo a:hover {
            text-decoration: underline;
        }

        /* Navigation */
        .breadcrumb {
            margin-bottom: 16px;
            font-size: 0.9rem;
        }

        .breadcrumb a {
            color: var(--primary);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .breadcrumb span {
            color: var(--text-muted);
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            border: 1px solid var(--border);
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border);
        }

        .card-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text);
        }

        .card-count {
            margin-left: auto;
            background: var(--bg);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* Sections */
        .section-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
        }

        /* Tags */
        .tag-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tag {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .tag-cell {
            background: #fce7f3;
            color: #9d174d;
        }

        .tag-gene {
            background: #dbeafe;
            color: #1e40af;
        }

        .tag-treatment {
            background: #ede9fe;
            color: #5b21b6;
        }

        .tag-env {
            background: #ccfbf1;
            color: #0f766e;
        }

        .tag-location {
            background: #e0e7ff;
            color: #3730a3;
        }

        .tag-component {
            background: #f0fdf4;
            color: #166534;
        }

        .tag-complex {
            background: #faf5ff;
            color: #7e22ce;
        }

        .tag-bio {
            background: #fef3c7;
            color: #92400e;
        }

        .tag-modifier {
            background: #fee2e2;
            color: #991b1b;
            text-transform: uppercase;
            letter-spacing: 0.02em;
        }

        .tag-parent {
            background: #e0e7ff;
            color: #3730a3;
        }

        .tag-classification {
            background: #fef3c7;
            color: #92400e;
        }

        .tag-mechanistic {
            background: #dbeafe;
            color: #1e40af;
        }

        .linkout {
            color: inherit;
            margin-left: 6px;
            font-size: 0.75rem;
            text-decoration: none;
            border-bottom: 1px dotted rgba(0, 0, 0, 0.2);
        }

        .classification-category {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .mapping-section {
            margin-bottom: 16px;
        }

        .mapping-item {
            padding: 10px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: #ffffff;
            margin-bottom: 10px;
        }

        .mapping-title {
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: baseline;
            margin-bottom: 6px;
        }

        .mapping-label {
            color: var(--text-muted);
            font-weight: 500;
        }

        .mapping-notes {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 6px;
        }

        .mapping-tree {
            margin-top: 6px;
            font-size: 0.75rem;
            color: var(--text-muted);
            list-style: none;
            padding-left: 0;
        }

        .mapping-tree li {
            margin: 2px 0;
        }

        /* Evidence styling */
        .evidence-toggle {
            cursor: pointer;
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 10px;
            user-select: none;
        }

        .evidence-toggle:hover {
            color: var(--primary);
        }

        .evidence-list {
            margin-top: 10px;
            padding-left: 0;
        }

        .evidence-item {
            padding: 12px 14px;
            background: #f8fafc;
            border-radius: 8px;
            margin-bottom: 8px;
            border: 1px solid #e2e8f0;
            font-size: 0.9rem;
        }

        .evidence-header {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
        }

        .evidence-ref {
            font-weight: 600;
            color: var(--secondary);
        }

        .evidence-ref a {
            color: inherit;
            text-decoration: none;
        }

        .evidence-ref a:hover {
            text-decoration: underline;
        }

        .evidence-support {
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 600;
            text-transform: uppercase;
            transition: transform 120ms ease, box-shadow 120ms ease;
        }

        .support-SUPPORT { background: #dcfce7; color: #166534; }
        .support-PARTIAL { background: #fef3c7; color: #92400e; }
        .support-REFUTE { background: #fee2e2; color: #991b1b; }
        .support-NO_EVIDENCE { background: #f1f5f9; color: #64748b; }
        .support-WRONG_STATEMENT { background: #fecaca; color: #7f1d1d; }

        .evidence-source {
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 600;
            text-transform: uppercase;
            background: #e2e8f0;
            color: #334155;
            transition: transform 120ms ease, box-shadow 120ms ease;
        }

        .evidence-support:hover,
        .evidence-source:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
        }

        .source-HUMAN_CLINICAL { background: #e0f2fe; color: #075985; }
        .source-MODEL_ORGANISM { background: #fef9c3; color: #854d0e; }
        .source-IN_VITRO { background: #ede9fe; color: #5b21b6; }
        .source-COMPUTATIONAL { background: #cffafe; color: #0e7490; }
        .source-OTHER { background: #e5e7eb; color: #374151; }

        .evidence-snippet {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 8px;
            padding-left: 12px;
            border-left: 2px solid #cbd5e1;
            font-style: italic;
            line-height: 1.5;
        }

        .evidence-explanation {
            font-size: 0.85rem;
            color: var(--text);
            margin-top: 6px;
            line-height: 1.5;
        }

        .evidence-more {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 6px;
            font-style: italic;
        }

        .findings-section {
            margin-top: 12px;
        }

        .findings-title {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        .finding-item {
            padding: 10px 12px;
            background: #f8fafc;
            border-radius: 8px;
            margin-bottom: 8px;
            border: 1px solid #e2e8f0;
            font-size: 0.9rem;
        }

        .finding-statement {
            font-weight: 600;
            color: var(--text);
            margin-bottom: 6px;
            line-height: 1.5;
        }

        .finding-supporting {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 6px;
            padding-left: 12px;
            border-left: 2px solid #cbd5e1;
            font-style: italic;
            line-height: 1.5;
        }

        /* Item containers with evidence */
        .item-box {
            padding: 16px;
            border-radius: 10px;
            margin-bottom: 12px;
        }

        .item-name {
            font-weight: 600;
            margin-bottom: 6px;
        }

        .item-desc {
            font-size: 0.9rem;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .item-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }

        /* Definitions */
        .definition-box {
            background: #ecfeff;
            border-left: 4px solid #0ea5e9;
        }
        .definition-box .item-name { color: #0c4a6e; }
        .definition-box .item-desc { color: #075985; }

        /* Inheritance */
        .inheritance-box {
            background: #fef9c3;
            border-left: 4px solid #ca8a04;
        }
        .inheritance-box .item-name { color: #92400e; }
        .inheritance-box .item-desc { color: #92400e; }

        .criteria-block {
            margin-top: 12px;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #bae6fd;
            background: rgba(255, 255, 255, 0.7);
        }

        .criteria-title {
            font-weight: 600;
            color: #0c4a6e;
            margin-bottom: 6px;
        }

        .criteria-meta {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .criteria-header {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            color: #0284c7;
            margin-top: 8px;
        }

        .criteria-list {
            margin-left: 18px;
            font-size: 0.9rem;
            line-height: 1.5;
            color: #0f172a;
        }

        .criteria-list li {
            margin-bottom: 6px;
        }

        .criteria-detail {
            display: block;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        /* Pathophysiology */
        .pathophys-box {
            background: linear-gradient(135deg, #fef3c7 0%, #fef9c3 100%);
            border-left: 4px solid var(--accent-orange);
        }
        .pathophys-box .item-name { color: #92400e; }
        .pathophys-box .item-desc { color: #78350f; }

        /* Histopathology */
        .histopathology-box {
            background: #fff7ed;
            border-left: 4px solid #fb923c;
        }
        .histopathology-box .item-name { color: #9a3412; }
        .histopathology-box .item-desc { color: #c2410c; }

        .histopathology-freq {
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 10px;
            background: #ffedd5;
            color: #c2410c;
        }

        /* Phenotypes */
        .phenotype-box {
            background: #f0fdf4;
            border-left: 4px solid #22c55e;
        }
        .phenotype-box .item-name { color: #166534; }
        .phenotype-box .item-desc { color: #15803d; }

        .phenotype-freq {
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 10px;
            background: #dcfce7;
            color: #15803d;
        }

        .phenotype-category {
            font-size: 0.75rem;
            color: #4ade80;
        }

        .phenotype-id a {
            font-size: 0.8rem;
            color: var(--secondary);
            text-decoration: none;
        }

        .phenotype-id a:hover {
            text-decoration: underline;
        }

        /* Phenotype TOC strip */
        .pheno-toc {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            padding: 10px 0 6px 0;
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: 4px;
        }

        .pheno-toc-pill {
            display: inline-block;
            font-size: 0.78rem;
            padding: 3px 10px;
            border-radius: 12px;
            background: #dcfce7;
            color: #166534;
            text-decoration: none;
            cursor: pointer;
            white-space: nowrap;
            transition: background 0.15s;
        }

        .pheno-toc-pill:hover {
            background: #bbf7d0;
        }

        .pheno-toc-pill .pill-count {
            font-weight: 600;
            margin-left: 2px;
        }

        .pheno-toggle-all {
            font-size: 0.78rem;
            color: #16a34a;
            cursor: pointer;
            background: none;
            border: 1px solid #bbf7d0;
            border-radius: 6px;
            padding: 3px 10px;
            margin-left: auto;
            white-space: nowrap;
            transition: background 0.15s;
        }

        .pheno-toggle-all:hover {
            background: #f0fdf4;
        }

        /* Collapsible category groups */
        .phenotype-category-group {
            margin-bottom: 2px;
        }

        .phenotype-category-group summary {
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            color: #16a34a;
            margin: 0;
            padding: 10px 0 6px 0;
            border-bottom: 1px solid #bbf7d0;
            cursor: pointer;
            list-style: none;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .phenotype-category-group summary::-webkit-details-marker {
            display: none;
        }

        .phenotype-category-group summary .chevron {
            display: inline-block;
            width: 16px;
            height: 16px;
            transition: transform 0.15s;
            flex-shrink: 0;
        }

        .phenotype-category-group[open] summary .chevron {
            transform: rotate(90deg);
        }

        .phenotype-category-group summary .cat-count {
            font-size: 0.75rem;
            font-weight: 400;
            color: #15803d;
            background: #dcfce7;
            padding: 1px 7px;
            border-radius: 8px;
        }

        /* Phenotype Contexts */
        .phenotype-contexts {
            margin-top: 10px;
        }

        .phenotype-contexts-toggle {
            font-size: 0.8rem;
            color: var(--text-muted);
            cursor: pointer;
            user-select: none;
        }

        .phenotype-contexts-toggle:hover {
            color: var(--primary);
        }

        .context-card {
            padding: 10px 14px;
            margin-top: 8px;
            border-radius: 8px;
            background: #ecfdf5;
            border: 1px solid #a7f3d0;
            font-size: 0.88rem;
        }

        .context-header {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 6px;
            margin-bottom: 6px;
        }

        .context-label {
            font-size: 0.72rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            padding: 2px 8px;
            border-radius: 4px;
        }

        .context-label-genetic {
            background: #dbeafe;
            color: #1e40af;
        }

        .context-label-sex {
            background: #fce7f3;
            color: #9d174d;
        }

        .context-label-population {
            background: #fef3c7;
            color: #92400e;
        }

        .context-label-age {
            background: #e0e7ff;
            color: #3730a3;
        }

        .context-label-subtype {
            background: #ede9fe;
            color: #5b21b6;
        }

        .context-label-frequency {
            background: #dcfce7;
            color: #166534;
        }

        .context-gene-list {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin: 4px 0;
        }

        .context-gene-tag {
            font-size: 0.78rem;
            font-weight: 600;
            padding: 1px 8px;
            border-radius: 4px;
            background: #bfdbfe;
            color: #1e3a8a;
        }

        .context-detail {
            font-size: 0.84rem;
            color: #065f46;
            line-height: 1.5;
        }

        .context-detail strong {
            color: #047857;
        }

        .context-freq {
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 10px;
            background: #bbf7d0;
            color: #14532d;
            font-weight: 600;
        }

        .context-onset {
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 10px;
            background: #e0e7ff;
            color: #3730a3;
        }

        .context-severity {
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 10px;
            background: #fef3c7;
            color: #92400e;
        }

        .context-notes {
            font-size: 0.84rem;
            color: #065f46;
            margin-top: 4px;
            line-height: 1.5;
        }

        /* Genetic */
        .genetic-box {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
        }
        .genetic-box .item-name { color: #1e40af; }
        .genetic-box .item-desc { color: #2563eb; }

        /* Treatment */
        .treatment-box {
            background: #faf5ff;
            border-left: 4px solid #8b5cf6;
        }
        .treatment-box .item-name { color: #5b21b6; }
        .treatment-box .item-desc { color: #7c3aed; }

        /* Environmental */
        .environmental-box {
            background: #f0fdfa;
            border-left: 4px solid #14b8a6;
        }
        .environmental-box .item-name { color: #0f766e; }
        .environmental-box .item-desc { color: #0d9488; }

        /* Biochemical */
        .biochemical-box {
            background: #fffbeb;
            border-left: 4px solid #f59e0b;
        }
        .biochemical-box .item-name { color: #92400e; }
        .biochemical-box .item-desc { color: #b45309; }

        /* Differential Diagnoses */
        .differential-box {
            background: #fef2f2;
            border-left: 4px solid #dc2626;
        }
        .differential-box .item-name { color: #7f1d1d; }
        .differential-box .item-desc { color: #b91c1c; }

        .differential-similarities {
            background: #fee2e2;
            border-left: 2px solid #dc2626;
            padding: 10px 12px;
            border-radius: 6px;
            margin: 8px 0;
            font-size: 0.9rem;
        }

        .differential-distinctions {
            background: #dcfce7;
            border-left: 2px solid #16a34a;
            padding: 10px 12px;
            border-radius: 6px;
            margin: 8px 0;
            font-size: 0.9rem;
        }

        .differential-similarities strong,
        .differential-distinctions strong {
            display: block;
            margin-bottom: 6px;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .differential-similarities ul,
        .differential-distinctions ul {
            margin-left: 16px;
            line-height: 1.6;
        }

        .differential-similarities li,
        .differential-distinctions li {
            margin: 4px 0;
            font-size: 0.9rem;
        }

        /* Datasets */
        .dataset-box {
            background: #f0f9ff;
            border-left: 4px solid #0284c7;
        }
        .dataset-box .item-name { color: #0c4a6e; }
        .dataset-box .item-desc { color: #0369a1; }

        .tag-dataset {
            background: #e0f2fe;
            color: #0369a1;
        }

        .tag-organism {
            background: #fae8ff;
            color: #a21caf;
        }

        .tag-datatype {
            background: #dbeafe;
            color: #1d4ed8;
        }

        /* Clinical Trials */
        .clinical-trial-box {
            background: #f5f3ff;
            border-left: 4px solid #a855f7;
        }
        .clinical-trial-box .item-name { color: #6b21a8; }
        .clinical-trial-box .item-desc { color: #7e22ce; }

        .tag-phase {
            background: #ede9fe;
            color: #6b21a8;
        }

        .tag-status {
            background: #fce7f3;
            color: #9d174d;
        }

        .trial-nct a {
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.85rem;
            color: var(--secondary);
            text-decoration: none;
        }

        .trial-nct a:hover {
            text-decoration: underline;
        }

        .dataset-accession a {
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.85rem;
            color: var(--secondary);
            text-decoration: none;
        }

        .dataset-accession a:hover {
            text-decoration: underline;
        }

        /* Subtypes */
        .subtype-box {
            background: #eef2ff;
            border-left: 4px solid var(--secondary);
        }
        .subtype-box .item-name { color: #3730a3; }
        .subtype-box .item-desc { color: #4f46e5; }
        .classification-header {
            font-size: 1rem;
            font-weight: 600;
            color: #4338ca;
            margin: 1.2rem 0 0.5rem 0;
            padding-bottom: 0.3rem;
            border-bottom: 2px solid #c7d2fe;
            text-transform: capitalize;
        }
        .subtype-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
            margin: 0.3rem 0;
        }
        .subtype-freq-badge {
            background: #dbeafe;
            color: #1e40af;
            padding: 0.15rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        .subtype-gene-tag {
            background: #fef3c7;
            color: #92400e;
            padding: 0.15rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        .subtype-inheritance-tag {
            background: #ede9fe;
            color: #5b21b6;
            padding: 0.15rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        .subtype-term-link {
            font-size: 0.8rem;
            color: #6366f1;
            text-decoration: none;
        }
        .subtype-term-link:hover { text-decoration: underline; }
        .subtype-children {
            margin: 0.4rem 0 0.2rem 1rem;
            padding: 0;
            list-style: none;
        }
        .subtype-children li {
            font-size: 0.85rem;
            color: #4338ca;
            padding: 0.1rem 0;
        }
        .subtype-children li::before {
            content: "‚Ü≥ ";
            color: #a5b4fc;
        }

        /* Stats bar */
        .stats-bar {
            display: flex;
            gap: 24px;
            padding: 20px 24px;
            background: var(--card-bg);
            border-radius: 12px;
            border: 1px solid var(--border);
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
        }

        .stat-link {
            text-decoration: none;
            color: inherit;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* YAML preview */
        .yaml-preview {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.85rem;
            line-height: 1.5;
            max-height: 400px;
            overflow-y: auto;
        }

        .yaml-content {
            display: none;
        }

        .yaml-content.show {
            display: block;
        }

        /* Footer */
        .page-footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
            text-align: center;
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .page-footer a {
            color: var(--primary);
            text-decoration: none;
        }

        .page-footer a:hover {
            text-decoration: underline;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .page-header h1 { font-size: 1.6rem; }
            .stats-bar { gap: 16px; }
            .section-grid { grid-template-columns: 1fr; }
        }
        /* Mermaid graph */
        .mermaid-container {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid var(--border);
            overflow-x: auto;
        }

        .mermaid svg {
            max-width: 100%;
            height: auto;
        }

        .graph-warning {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 16px;
            font-size: 0.85rem;
            color: #92400e;
        }

        .graph-warning strong {
            display: block;
            margin-bottom: 4px;
        }

        .graph-warning ul {
            margin: 8px 0 0 20px;
            padding: 0;
        }

        .graph-warning li {
            margin: 4px 0;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
</head>
<body>
    <div class="notice-banner" role="button" tabindex="0">This resource is in its pre-alpha development stage. Content is actively being curated and may be incomplete or subject to change.</div>
    {# ========== MACROS ========== #}

    {% set modifier_icons = {
        'INCREASED': '‚Üë',
        'DECREASED': '‚Üì',
        'ABNORMAL': '‚ö†',
        'DYSREGULATED': '‚Üï',
        'ABSENT': '‚àÖ'
    } %}

    {# Evidence rendering macro - reusable for any item with evidence #}
    {% macro render_evidence(evidence_list, max_visible=3, accent_color="#64748b") %}
    {% if evidence_list %}
    <details class="evidence-details">
        <summary class="evidence-toggle">
            Show evidence ({{ evidence_list | length }} reference{{ 's' if evidence_list | length != 1 else '' }})
        </summary>
        <div class="evidence-list">
            {% for ev in evidence_list[:max_visible] %}
            <div class="evidence-item">
                <div class="evidence-header">
                    <span class="evidence-ref">
                        <a href="{{ ev.reference | curie_to_url }}" target="_blank">{{ ev.reference }}</a>
                    </span>
                    {% if ev.supports %}
                    <span class="evidence-support support-{{ ev.supports }}">{{ ev.supports }}</span>
                    {% endif %}
                    {% if ev.evidence_source %}
                    <span class="evidence-source source-{{ ev.evidence_source }}">{{ ev.evidence_source | replace('_', ' ') | title }}</span>
                    {% endif %}
                </div>
                {% if ev.snippet %}
                <div class="evidence-snippet">"{{ ev.snippet | truncate(300) }}"</div>
                {% endif %}
                {% if ev.explanation %}
                <div class="evidence-explanation">{{ ev.explanation }}</div>
                {% endif %}
            </div>
            {% endfor %}
            {% if evidence_list | length > max_visible %}
            <div class="evidence-more">+ {{ evidence_list | length - max_visible }} more reference{{ 's' if (evidence_list | length - max_visible) != 1 else '' }}</div>
            {% endif %}
        </div>
    </details>
    {% endif %}
    {% endmacro %}

    {# Phenotype contexts rendering macro #}
    {% macro render_phenotype_contexts(contexts) %}
    {% if contexts %}
    <details class="phenotype-contexts">
        <summary class="phenotype-contexts-toggle">
            Context-specific annotations ({{ contexts | length }})
        </summary>
        {% for ctx in contexts %}
        <div class="context-card">
            <div class="context-header">
                {# Genetic context #}
                {% if ctx.genetic_context %}
                <span class="context-label context-label-genetic">Genetic</span>
                {% if ctx.genetic_context.complementation_group %}
                <span class="context-gene-tag">{{ ctx.genetic_context.complementation_group }}</span>
                {% endif %}
                {% if ctx.genetic_context.gene %}
                <span class="context-gene-tag">{{ ctx.genetic_context.gene.preferred_term or ctx.genetic_context.gene.term.label }}</span>
                {% endif %}
                {% if ctx.genetic_context.genes %}
                {% for g in ctx.genetic_context.genes %}
                <span class="context-gene-tag">{{ g.preferred_term or g.term.label }}</span>
                {% endfor %}
                {% endif %}
                {% if ctx.genetic_context.allele_type %}
                <span class="context-gene-tag" style="background: #e9d5ff; color: #6b21a8;">{{ ctx.genetic_context.allele_type }}</span>
                {% endif %}
                {% if ctx.genetic_context.zygosity %}
                <span class="context-gene-tag" style="background: #fce7f3; color: #9d174d;">{{ ctx.genetic_context.zygosity }}</span>
                {% endif %}
                {% endif %}
                {# Sex #}
                {% if ctx.sex %}
                <span class="context-label context-label-sex">{{ ctx.sex }}</span>
                {% endif %}
                {# Population #}
                {% if ctx.population %}
                <span class="context-label context-label-population">{{ ctx.population }}</span>
                {% endif %}
                {# Age range #}
                {% if ctx.age_range %}
                <span class="context-label context-label-age">{{ ctx.age_range }}</span>
                {% endif %}
                {# Subtype #}
                {% if ctx.subtype %}
                <span class="context-label context-label-subtype">{{ ctx.subtype }}</span>
                {% endif %}
                {# Frequency, onset, severity badges #}
                {% if ctx.frequency %}
                <span class="context-freq">{{ ctx.frequency }}</span>
                {% endif %}
                {% if ctx.onset %}
                <span class="context-onset">Onset:
                  {%- if ctx.onset.onset_category %} {{ ctx.onset.onset_category }}{% endif -%}
                  {%- if ctx.onset.mean_age_years is not none %} mean {{ ctx.onset.mean_age_years }}y{% endif -%}
                  {%- if ctx.onset.min_age_years is not none %} min {{ ctx.onset.min_age_years }}y{% endif -%}
                  {%- if ctx.onset.max_age_years is not none %} max {{ ctx.onset.max_age_years }}y{% endif -%}
                </span>
                {% endif %}
                {% if ctx.severity %}
                <span class="context-severity">{{ ctx.severity }}</span>
                {% endif %}
            </div>
            {% if ctx.genetic_context and ctx.genetic_context.description %}
            <div class="context-detail">{{ ctx.genetic_context.description }}</div>
            {% endif %}
            {% if ctx.notes %}
            <div class="context-notes">{{ ctx.notes }}</div>
            {% endif %}
            {{ render_evidence(ctx.evidence) }}
        </div>
        {% endfor %}
    </details>
    {% endif %}
    {% endmacro %}

    {% macro render_findings(findings_list) %}
    {% if findings_list %}
    <div class="findings-section">
        <div class="findings-title">Findings</div>
        {% for finding in findings_list %}
        <div class="finding-item">
            {% if finding.statement %}
            <div class="finding-statement">{{ finding.statement }}</div>
            {% endif %}
            {% if finding.supporting_text %}
            <div class="finding-supporting">"{{ finding.supporting_text | truncate(300) }}"</div>
            {% endif %}
            {{ render_evidence(finding.evidence) }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    {% endmacro %}

    {% macro render_modifier(modifier) %}
    {% if modifier %}
    <span class="tag tag-modifier">
        {{ modifier_icons.get(modifier, '') }} {{ modifier | replace('_', ' ') }}
    </span>
    {% endif %}
    {% endmacro %}

    {% macro render_criteria_list(title, items) %}
    {% if items %}
    <div class="criteria-group">
        <div class="criteria-header">{{ title }}</div>
        <ul class="criteria-list">
            {% for item in items %}
            <li>
                <span class="criteria-term">{{ item.preferred_term }}</span>
                {% if item.description %}
                <span class="criteria-detail">{{ item.description }}</span>
                {% endif %}
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
    {% endmacro %}

    {% macro render_inheritance_meta(inh) %}
    {% set has_meta = inh.inheritance_term or inh.penetrance or inh.penetrance_percentage or inh.expressivity or inh.de_novo_rate %}
    {% if has_meta %}
    <div class="item-meta">
        {% if inh.inheritance_term %}
        <span class="tag tag-classification">
            {{ inh.inheritance_term.preferred_term or (inh.inheritance_term.term and inh.inheritance_term.term.label) or 'Inheritance term' }}
        </span>
        {% endif %}
        {% if inh.penetrance %}
        <span class="tag tag-classification">Penetrance: {{ inh.penetrance }}</span>
        {% endif %}
        {% if inh.penetrance_percentage %}
        <span class="tag tag-classification">Penetrance %: {{ inh.penetrance_percentage }}</span>
        {% endif %}
        {% if inh.expressivity %}
        <span class="tag tag-classification">Expressivity: {{ inh.expressivity }}</span>
        {% endif %}
        {% if inh.de_novo_rate %}
        <span class="tag tag-classification">De novo rate: {{ inh.de_novo_rate }}</span>
        {% endif %}
    </div>
    {% endif %}
    {% if inh.parent_of_origin_effect %}
    <div class="item-desc"><strong>Parent-of-origin effect:</strong> {{ inh.parent_of_origin_effect }}</div>
    {% endif %}
    {% endmacro %}

    {# ========== PAGE CONTENT ========== #}

    <div class="container">
        <nav class="breadcrumb">
            <a href="../../app/index.html">Browse All</a>
            <span> / </span>
            <span>{{ disorder.name }}</span>
        </nav>

        <header class="page-header">
            <h1>{{ disorder.name }}</h1>
            <div class="header-meta">
                {% if disorder.category %}
                <span class="badge badge-category">{{ disorder.category }}</span>
                {% endif %}
                {% if disorder.disease_term and disorder.disease_term.term %}
                <span class="badge badge-mondo">
                    <a href="{{ disorder.disease_term.term.id | curie_to_url }}" target="_blank">
                        {{ disorder.disease_term.term.id }}
                    </a>
                </span>
                {% endif %}
                {% for parent in disorder.parents or [] %}
                <span class="badge badge-category" style="background: rgba(255,255,255,0.1);">{{ parent }}</span>
                {% endfor %}
            </div>
            {% if disorder.description %}
            <p style="margin-top: 16px; font-size: 1rem; line-height: 1.6; opacity: 0.95; position: relative;">
                {{ disorder.description }}
            </p>
            {% endif %}
        </header>

        <!-- Stats bar -->
        {% set pathophysiology_count = (disorder.pathophysiology or []) | length %}
        {% set histopathology_count = (disorder.histopathology or []) | length %}
        {% set phenotypes_count = (disorder.phenotypes or []) | length %}
        {% set genetic_count = (disorder.genetic or []) | length %}
        {% set treatments_count = (disorder.treatments or []) | length %}
        {% set definitions_count = (disorder.definitions or []) | length %}
        {% set inheritance_count = (disorder.inheritance or []) | length %}
        {% set subtypes_count = (disorder.has_subtypes or []) | length %}
        {% set differentials_count = (disorder.differential_diagnoses or []) | length %}
        {% set datasets_count = (disorder.datasets or []) | length %}
        {% set trials_count = (disorder.clinical_trials or []) | length %}
        {% set ns = namespace(mappings_count=0) %}
        {% for mapping_list in (disorder.mappings or {}).values() %}
            {% if mapping_list is sequence and mapping_list is not string %}
                {% set ns.mappings_count = ns.mappings_count + (mapping_list | length) %}
            {% endif %}
        {% endfor %}
        <div class="stats-bar">
            {% if ns.mappings_count %}
            <a class="stat-link" href="#mappings">
            <div class="stat-item">
                <div class="stat-value">{{ ns.mappings_count }}</div>
                <div class="stat-label">Mappings</div>
            </div>
            </a>
            {% else %}
            <div class="stat-item">
                <div class="stat-value">{{ ns.mappings_count }}</div>
                <div class="stat-label">Mappings</div>
            </div>
            {% endif %}
            {% if definitions_count %}
            <a class="stat-link" href="#definitions">
            <div class="stat-item">
                <div class="stat-value">{{ definitions_count }}</div>
                <div class="stat-label">Definitions</div>
            </div>
            </a>
            {% else %}
            <div class="stat-item">
                <div class="stat-value">{{ definitions_count }}</div>
                <div class="stat-label">Definitions</div>
            </div>
            {% endif %}
            {% if inheritance_count %}
            <a class="stat-link" href="#inheritance">
            <div class="stat-item">
                <div class="stat-value">{{ inheritance_count }}</div>
                <div class="stat-label">Inheritance</div>
            </div>
            </a>
            {% else %}
            <div class="stat-item">
                <div class="stat-value">{{ inheritance_count }}</div>
                <div class="stat-label">Inheritance</div>
            </div>
            {% endif %}
            {% if pathophysiology_count %}
            <a class="stat-link" href="#pathophysiology">
            <div class="stat-item">
                <div class="stat-value">{{ pathophysiology_count }}</div>
                <div class="stat-label">Pathophysiology</div>
            </div>
            </a>
            {% else %}
            <div class="stat-item">
                <div class="stat-value">{{ pathophysiology_count }}</div>
                <div class="stat-label">Pathophysiology</div>
            </div>
            {% endif %}
            {% if histopathology_count %}
            <a class="stat-link" href="#histopathology">
            <div class="stat-item">
                <div class="stat-value">{{ histopathology_count }}</div>
                <div class="stat-label">Histopathology</div>
            </div>
            </a>
            {% else %}
            <div class="stat-item">
                <div class="stat-value">{{ histopathology_count }}</div>
                <div class="stat-label">Histopathology</div>
            </div>
            {% endif %}
            {% if phenotypes_count %}
            <a class="stat-link" href="#phenotypes">
            <div class="stat-item">
                <div class="stat-value">{{ phenotypes_count }}</div>
                <div class="stat-label">Phenotypes</div>
            </div>
            </a>
            {% else %}
            <div class="stat-item">
                <div class="stat-value">{{ phenotypes_count }}</div>
                <div class="stat-label">Phenotypes</div>
            </div>
            {% endif %}
            {% if genetic_count %}
            <a class="stat-link" href="#genetic">
            <div class="stat-item">
                <div class="stat-value">{{ genetic_count }}</div>
                <div class="stat-label">Genes</div>
            </div>
            </a>
            {% else %}
            <div class="stat-item">
                <div class="stat-value">{{ genetic_count }}</div>
                <div class="stat-label">Genes</div>
            </div>
            {% endif %}
            {% if treatments_count %}
            <a class="stat-link" href="#treatments">
            <div class="stat-item">
                <div class="stat-value">{{ treatments_count }}</div>
                <div class="stat-label">Treatments</div>
            </div>
            </a>
            {% else %}
            <div class="stat-item">
                <div class="stat-value">{{ treatments_count }}</div>
                <div class="stat-label">Treatments</div>
            </div>
            {% endif %}
            {% if subtypes_count %}
            <a class="stat-link" href="#subtypes">
            <div class="stat-item">
                <div class="stat-value">{{ subtypes_count }}</div>
                <div class="stat-label">Subtypes</div>
            </div>
            </a>
            {% else %}
            <div class="stat-item">
                <div class="stat-value">{{ subtypes_count }}</div>
                <div class="stat-label">Subtypes</div>
            </div>
            {% endif %}
            {% if differentials_count %}
            <a class="stat-link" href="#differentials">
            <div class="stat-item">
                <div class="stat-value">{{ differentials_count }}</div>
                <div class="stat-label">Differentials</div>
            </div>
            </a>
            {% else %}
            <div class="stat-item">
                <div class="stat-value">{{ differentials_count }}</div>
                <div class="stat-label">Differentials</div>
            </div>
            {% endif %}
            {% if datasets_count %}
            <a class="stat-link" href="#datasets">
            <div class="stat-item">
                <div class="stat-value">{{ datasets_count }}</div>
                <div class="stat-label">Datasets</div>
            </div>
            </a>
            {% else %}
            <div class="stat-item">
                <div class="stat-value">{{ datasets_count }}</div>
                <div class="stat-label">Datasets</div>
            </div>
            {% endif %}
            {% if trials_count %}
            <a class="stat-link" href="#trials">
            <div class="stat-item">
                <div class="stat-value">{{ trials_count }}</div>
                <div class="stat-label">Trials</div>
            </div>
            </a>
            {% else %}
            <div class="stat-item">
                <div class="stat-value">{{ trials_count }}</div>
                <div class="stat-label">Trials</div>
            </div>
            {% endif %}
        </div>

        <!-- Classifications -->
        {% if disorder.classifications %}
        <div class="card">
            <div class="card-header">
                <div class="card-icon" style="background: #fef3c7; color: #d97706;">üè∑</div>
                <h2 class="card-title">Classifications</h2>
            </div>
            {% if disorder.classifications.harrisons_chapter %}
            <div style="margin-bottom: 16px;">
                <div class="classification-category">Harrison's Chapter</div>
                <div class="tag-list">
                    {% for hc in disorder.classifications.harrisons_chapter %}
                    <span class="tag tag-classification">{{ hc.classification_value }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            {% if disorder.classifications.mechanistic_category %}
            <div style="margin-bottom: 16px;">
                <div class="classification-category">Mechanistic Nosology</div>
                <div class="tag-list">
                    {% for mc in disorder.classifications.mechanistic_category %}
                    <span class="tag tag-mechanistic">{{ mc.classification_value }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            {% if disorder.classifications.icdo_morphology %}
            <div style="margin-bottom: 16px;">
                <div class="classification-category">ICD-O Morphology</div>
                <div class="tag-list">
                    <span class="tag tag-classification">{{ disorder.classifications.icdo_morphology.classification_value }}</span>
                </div>
            </div>
            {% endif %}
            {% if disorder.classifications.lysosomal_storage_category %}
            <div style="margin-bottom: 16px;">
                <div class="classification-category">Lysosomal Storage</div>
                <div class="tag-list">
                    <span class="tag tag-mechanistic">{{ disorder.classifications.lysosomal_storage_category.classification_value }}</span>
                </div>
            </div>
            {% endif %}
            {% if disorder.classifications.iuis_category %}
            <div style="margin-bottom: 16px;">
                <div class="classification-category">IUIS Category</div>
                <div class="tag-list">
                    <span class="tag tag-classification">{{ disorder.classifications.iuis_category.classification_value }}</span>
                </div>
            </div>
            {% endif %}
            {% if disorder.classifications.channelopathy_category %}
            <div style="margin-bottom: 16px;">
                <div class="classification-category">Channelopathy</div>
                <div class="tag-list">
                    <span class="tag tag-mechanistic">{{ disorder.classifications.channelopathy_category.classification_value }}</span>
                </div>
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Mappings -->
        {% if disorder.mappings %}
        <div class="card" id="mappings">
            <div class="card-header">
                <div class="card-icon" style="background: #e0f2fe; color: #0369a1;">üîó</div>
                <h2 class="card-title">Mappings</h2>
            </div>
            {% if disorder.mappings.mondo_mappings %}
            <div class="mapping-section">
                <div class="classification-category">MONDO</div>
                {% for mapping in disorder.mappings.mondo_mappings %}
                <div class="mapping-item">
                    <div class="mapping-title">
                        {% if mapping.term and mapping.term.id %}
                        <a href="{{ mapping.term.id | curie_to_url }}" target="_blank">{{ mapping.term.id }}</a>
                        {% endif %}
                        {% if mapping.term and mapping.term.label %}
                        <span class="mapping-label">{{ mapping.term.label }}</span>
                        {% endif %}
                    </div>
                    <div class="tag-list">
                        {% if mapping.mapping_predicate %}
                        <span class="tag tag-classification">{{ mapping.mapping_predicate }}</span>
                        {% endif %}
                        {% if mapping.mapping_source %}
                        <span class="tag tag-parent">{{ mapping.mapping_source }}</span>
                        {% endif %}
                        {% if mapping.consistency %}
                        {% for c in mapping.consistency %}
                        <span class="tag tag-mechanistic">{{ c.reference }}: {{ c.consistent }}</span>
                        {% endfor %}
                        {% endif %}
                    </div>
                    {% if mapping.mapping_justification %}
                    <div class="mapping-notes">{{ mapping.mapping_justification }}</div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% endif %}
            {% if disorder.mappings.icd10cm_mappings %}
            <div class="mapping-section">
                <div class="classification-category">ICD-10-CM</div>
                {% for mapping in disorder.mappings.icd10cm_mappings %}
                <div class="mapping-item">
                    <div class="mapping-title">
                        {% if mapping.term and mapping.term.id %}
                        <a href="{{ mapping.term.id | curie_to_url }}" target="_blank">{{ mapping.term.id }}</a>
                        {% endif %}
                        {% if mapping.term and mapping.term.label %}
                        <span class="mapping-label">{{ mapping.term.label }}</span>
                        {% endif %}
                    </div>
                    <div class="tag-list">
                        {% if mapping.mapping_predicate %}
                        <span class="tag tag-classification">{{ mapping.mapping_predicate }}</span>
                        {% endif %}
                        {% if mapping.mapping_source %}
                        <span class="tag tag-parent">{{ mapping.mapping_source }}</span>
                        {% endif %}
                        {% if mapping.consistency %}
                        {% for c in mapping.consistency %}
                        <span class="tag tag-mechanistic">{{ c.reference }}: {{ c.consistent }}</span>
                        {% endfor %}
                        {% endif %}
                    </div>
                    {% if mapping.mapping_justification %}
                    <div class="mapping-notes">{{ mapping.mapping_justification }}</div>
                    {% endif %}
                    {% if mapping.hierarchy_path %}
                    <ul class="mapping-tree">
                        {% for node in mapping.hierarchy_path %}
                        <li style="padding-left: {{ loop.index0 * 14 }}px;">
                            {% if node.is_ellipsis %}
                            <span class="mapping-ellipsis">{{ node.label }}</span>
                            {% else %}
                            {% if node.id %}
                            <a href="{{ node.id | curie_to_url }}" target="_blank">{{ node.label }}</a>
                            {% else %}
                            {{ node.label }}
                            {% endif %}
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% endif %}
            {% if disorder.mappings.icd11f_mappings %}
            <div class="mapping-section">
                <div class="classification-category">ICD-11 Foundation</div>
                {% for mapping in disorder.mappings.icd11f_mappings %}
                <div class="mapping-item">
                    <div class="mapping-title">
                        {% if mapping.term and mapping.term.id %}
                        <a href="{{ mapping.term.id | curie_to_url }}" target="_blank">{{ mapping.term.id }}</a>
                        {% endif %}
                        {% if mapping.term and mapping.term.label %}
                        <span class="mapping-label">{{ mapping.term.label }}</span>
                        {% endif %}
                    </div>
                    <div class="tag-list">
                        {% if mapping.mapping_predicate %}
                        <span class="tag tag-classification">{{ mapping.mapping_predicate }}</span>
                        {% endif %}
                        {% if mapping.mapping_source %}
                        <span class="tag tag-parent">{{ mapping.mapping_source }}</span>
                        {% endif %}
                        {% if mapping.consistency %}
                        {% for c in mapping.consistency %}
                        <span class="tag tag-mechanistic">{{ c.reference }}: {{ c.consistent }}</span>
                        {% endfor %}
                        {% endif %}
                    </div>
                    {% if mapping.mapping_justification %}
                    <div class="mapping-notes">{{ mapping.mapping_justification }}</div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Definitions -->
        {% if disorder.definitions %}
        <div class="card" id="definitions">
            <div class="card-header">
                <div class="card-icon" style="background: #cffafe; color: #0e7490;">üìò</div>
                <h2 class="card-title">Definitions</h2>
                <span class="card-count">{{ disorder.definitions | length }}</span>
            </div>
            {% for definition in disorder.definitions %}
            <div class="item-box definition-box">
                <div class="item-name">{{ definition.name }}</div>
                {% if definition.description %}
                <div class="item-desc">{{ definition.description }}</div>
                {% endif %}
                <div class="item-meta">
                    {% if definition.definition_type %}
                    <span class="tag tag-classification">{{ definition.definition_type }}</span>
                    {% endif %}
                    {% if definition.scope %}
                    <span class="tag tag-parent">{{ definition.scope }}</span>
                    {% endif %}
                </div>
                {{ render_criteria_list('Core clinical characteristics', definition.core_clinical_characteristics) }}
                {{ render_criteria_list('Inclusion criteria', definition.inclusion_criteria) }}
                {{ render_criteria_list('Exclusion criteria', definition.exclusion_criteria) }}
                {{ render_criteria_list('Imaging requirements', definition.imaging_requirements) }}
                {{ render_criteria_list('Laboratory requirements', definition.laboratory_requirements) }}
                {{ render_criteria_list('Additional requirements', definition.additional_requirements) }}
                {% if definition.criteria_sets %}
                {% for criteria_set in definition.criteria_sets %}
                <div class="criteria-block">
                    <div class="criteria-title">{{ criteria_set.name }}</div>
                    {% if criteria_set.description %}
                    <div class="item-desc">{{ criteria_set.description }}</div>
                    {% endif %}
                    {% if criteria_set.scope or criteria_set.minimum_required %}
                    <div class="criteria-meta">
                        {% if criteria_set.scope %}Scope: {{ criteria_set.scope }}{% endif %}
                        {% if criteria_set.scope and criteria_set.minimum_required %} | {% endif %}
                        {% if criteria_set.minimum_required %}Minimum required: {{ criteria_set.minimum_required }}{% endif %}
                    </div>
                    {% endif %}
                    {{ render_criteria_list('Core clinical characteristics', criteria_set.core_clinical_characteristics) }}
                    {{ render_criteria_list('Inclusion criteria', criteria_set.inclusion_criteria) }}
                    {{ render_criteria_list('Exclusion criteria', criteria_set.exclusion_criteria) }}
                    {{ render_criteria_list('Imaging requirements', criteria_set.imaging_requirements) }}
                    {{ render_criteria_list('Laboratory requirements', criteria_set.laboratory_requirements) }}
                    {{ render_criteria_list('Additional requirements', criteria_set.additional_requirements) }}
                    {{ render_evidence(criteria_set.evidence) }}
                    {% if criteria_set.notes %}
                    <div class="item-desc">Notes: {{ criteria_set.notes }}</div>
                    {% endif %}
                </div>
                {% endfor %}
                {% endif %}
                {{ render_evidence(definition.evidence) }}
                {% if definition.notes %}
                <div class="item-desc">Notes: {{ definition.notes }}</div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Inheritance -->
        {% if disorder.inheritance %}
        <div class="card" id="inheritance">
            <div class="card-header">
                <div class="card-icon" style="background: #fef3c7; color: #92400e;">üë™</div>
                <h2 class="card-title">Inheritance</h2>
                <span class="card-count">{{ disorder.inheritance | length }}</span>
            </div>
            {% for inh in disorder.inheritance %}
            <div class="item-box inheritance-box">
                <div class="item-name">
                    {{ inh.name }}
                    {% if inh.inheritance_term and inh.inheritance_term.term %}
                    <span class="phenotype-id">
                        <a href="{{ inh.inheritance_term.term.id | curie_to_url }}" target="_blank">
                            {{ inh.inheritance_term.term.id }}
                        </a>
                    </span>
                    {% endif %}
                </div>
                {% if inh.description %}
                <div class="item-desc">{{ inh.description }}</div>
                {% endif %}
                {{ render_inheritance_meta(inh) }}
                {{ render_evidence(inh.evidence) }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Subtypes -->
        {% if disorder.has_subtypes %}
        <div class="card" id="subtypes">
            <div class="card-header">
                <div class="card-icon" style="background: #eef2ff; color: #4f46e5;">‚óÜ</div>
                <h2 class="card-title">Subtypes</h2>
                <span class="card-count">{{ disorder.has_subtypes | length }}</span>
            </div>
            {# Group subtypes by classification #}
            {% set ns = namespace(schemes={}) %}
            {% for subtype in disorder.has_subtypes %}
                {% set scheme = subtype.classification or 'General' %}
                {% if scheme not in ns.schemes %}
                    {% set _ = ns.schemes.update({scheme: []}) %}
                {% endif %}
                {% set _ = ns.schemes[scheme].append(subtype) %}
            {% endfor %}
            {% for scheme, subtypes_in_scheme in ns.schemes.items() %}
                {% if ns.schemes | length > 1 %}
                <div class="classification-header">{{ scheme | replace('_', ' ') }}</div>
                {% endif %}
                {% for subtype in subtypes_in_scheme %}
                <div class="item-box subtype-box">
                    <div class="item-name">
                        {{ subtype.name }}
                        {% if subtype.subtype_term and subtype.subtype_term.term and subtype.subtype_term.term.id %}
                        <a class="subtype-term-link" href="{{ subtype.subtype_term.term.id | curie_to_url }}" target="_blank">{{ subtype.subtype_term.term.id }}</a>
                        {% endif %}
                    </div>
                    <div class="subtype-meta">
                        {% if subtype.subtype_frequency %}
                        <span class="subtype-freq-badge">{{ subtype.subtype_frequency }}</span>
                        {% endif %}
                        {% if subtype.genes %}
                            {% for gene in subtype.genes %}
                            <span class="subtype-gene-tag">{{ gene.preferred_term or gene.term.label }}</span>
                            {% endfor %}
                        {% endif %}
                        {% if subtype.inheritance %}
                            {% for inh in subtype.inheritance %}
                            <span class="subtype-inheritance-tag">{{ inh.inheritance_term.preferred_term if inh.inheritance_term else inh }}</span>
                            {% endfor %}
                        {% endif %}
                    </div>
                    {% if subtype.description %}
                    <div class="item-desc">{{ subtype.description }}</div>
                    {% endif %}
                    {% if subtype.children %}
                    <ul class="subtype-children">
                        {% for child_name in subtype.children %}
                        <li>{{ child_name }}</li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                    {{ render_evidence(subtype.evidence) }}
                </div>
                {% endfor %}
            {% endfor %}
        </div>
        {% endif %}

        <!-- Comorbidities -->
        {% if comorbidity_links %}
        <div class="card" id="comorbidities">
            <div class="card-header">
                <div class="card-icon" style="background: #ede9fe; color: #6d28d9;">C</div>
                <h2 class="card-title">Comorbidities</h2>
            </div>
            <div class="mapping-section">
                {% for link in comorbidity_links %}
                <div class="mapping-item">
                    <div class="mapping-title">
                        <a href="{{ link.href }}">{{ link.title }}</a>
                    </div>
                    <div class="tag-list">
                        {% if link.role_label %}
                        <span class="tag tag-parent">{{ link.role_label }}</span>
                        {% endif %}
                        {% if link.directionality %}
                        <span class="tag tag-classification">{{ link.directionality }}</span>
                        {% endif %}
                        {% if link.curation_status %}
                        <span class="tag tag-mechanistic">{{ link.curation_status }}</span>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Pathophysiology -->
        {% if disorder.pathophysiology %}
        <div class="card" id="pathophysiology">
            <div class="card-header">
                <div class="card-icon" style="background: #fef3c7; color: #d97706;">‚öô</div>
                <h2 class="card-title">Pathophysiology</h2>
                <span class="card-count">{{ disorder.pathophysiology | length }}</span>
            </div>
            {% for patho in disorder.pathophysiology %}
            <div class="item-box pathophys-box">
                <div class="item-name">{{ patho.name }}</div>
                {% if patho.description %}
                <div class="item-desc">{{ patho.description }}</div>
                {% endif %}
                {% if patho.cell_types %}
                <div class="item-meta">
                    {% for ct in patho.cell_types %}
                    <span class="tag tag-cell">
                        {{ ct.preferred_term or ct.term.label }}
                        {% if ct.term and ct.term.id %}
                        <a href="{{ ct.term.id | curie_to_url }}" target="_blank" class="linkout">link</a>
                        {% endif %}
                    </span>
                    {{ render_modifier(ct.modifier) }}
                    {% endfor %}
                </div>
                {% endif %}
                {% if patho.genes %}
                <div class="item-meta">
                    {% for g in patho.genes %}
                    <span class="tag tag-gene">
                        {{ g.preferred_term or g.term.label }}
                        {% if g.term and g.term.id %}
                        <a href="{{ g.term.id | curie_to_url }}" target="_blank" class="linkout">link</a>
                        {% endif %}
                    </span>
                    {% endfor %}
                </div>
                {% endif %}
                {% if patho.protein_complexes %}
                <div class="item-meta">
                    {% for pc in patho.protein_complexes %}
                    <span class="tag tag-complex">
                        {{ pc.preferred_term or pc.term.label }}
                        {% if pc.term and pc.term.id %}
                        <a href="{{ pc.term.id | curie_to_url }}" target="_blank" class="linkout">link</a>
                        {% endif %}
                    </span>
                    {% endfor %}
                </div>
                {% endif %}
                {% if patho.biological_processes %}
                <div class="item-meta">
                    {% for bp in patho.biological_processes %}
                    <span class="tag tag-bio">
                        {{ bp.preferred_term or bp.term.label }}
                        {% if bp.term and bp.term.id %}
                        <a href="{{ bp.term.id | curie_to_url }}" target="_blank" class="linkout">link</a>
                        {% endif %}
                    </span>
                    {{ render_modifier(bp.modifier) }}
                    {% endfor %}
                </div>
                {% endif %}
                {% if patho.cellular_components %}
                <div class="item-meta">
                    {% for cc in patho.cellular_components %}
                    <span class="tag tag-component">
                        {{ cc.preferred_term or cc.term.label }}
                        {% if cc.term and cc.term.id %}
                        <a href="{{ cc.term.id | curie_to_url }}" target="_blank" class="linkout">link</a>
                        {% endif %}
                    </span>
                    {% endfor %}
                </div>
                {% endif %}
                {% if patho.locations %}
                <div class="item-meta">
                    {% for loc in patho.locations %}
                    <span class="tag tag-location">
                        {{ loc.preferred_term or loc.term.label }}
                        {% if loc.term and loc.term.id %}
                        <a href="{{ loc.term.id | curie_to_url }}" target="_blank" class="linkout">link</a>
                        {% endif %}
                    </span>
                    {% endfor %}
                </div>
                {% endif %}
                {{ render_evidence(patho.evidence) }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Histopathology -->
        {% if disorder.histopathology %}
        <div class="card" id="histopathology">
            <div class="card-header">
                <div class="card-icon" style="background: #ffedd5; color: #c2410c;">‚ú∂</div>
                <h2 class="card-title">Histopathology</h2>
                <span class="card-count">{{ disorder.histopathology | length }}</span>
            </div>
            {% for histo in disorder.histopathology %}
            <div class="item-box histopathology-box">
                <div class="item-name">
                    {{ histo.name }}
                    {% if histo.frequency %}
                    <span class="histopathology-freq">{{ histo.frequency }}</span>
                    {% endif %}
                </div>
                {% if histo.description %}
                <div class="item-desc">{{ histo.description }}</div>
                {% endif %}
                {{ render_evidence(histo.evidence) }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Causal Graph -->
        {% if mermaid_code %}
        <div class="card">
            <div class="card-header">
                <div class="card-icon" style="background: #e0e7ff; color: #4f46e5;">‚¨°</div>
                <h2 class="card-title">Causal Graph</h2>
            </div>
            {% if graph_issues %}
            <div class="graph-warning">
                <strong>Referential integrity issues ({{ graph_issues | length }}):</strong>
                <ul>
                    {% for issue in graph_issues[:5] %}
                    <li>{{ issue }}</li>
                    {% endfor %}
                    {% if graph_issues | length > 5 %}
                    <li><em>... and {{ graph_issues | length - 5 }} more</em></li>
                    {% endif %}
                </ul>
            </div>
            {% endif %}
            <div class="mermaid-container">
                <pre class="mermaid">{{ mermaid_code }}</pre>
            </div>
        </div>
        {% endif %}

        <!-- Phenotypes -->
        {% if disorder.phenotypes %}
        <div class="card" id="phenotypes">
            <div class="card-header">
                <div class="card-icon" style="background: #dcfce7; color: #16a34a;">‚óè</div>
                <h2 class="card-title">Phenotypes</h2>
                <span class="card-count">{{ disorder.phenotypes | length }}</span>
            </div>
            {% if phenotype_groups and phenotype_groups | length > 1 %}
            {# --- TOC strip --- #}
            <div class="pheno-toc">
                {% for category_name, phenos in phenotype_groups %}
                <a class="pheno-toc-pill" data-target="pheno-cat-{{ loop.index }}">{{ category_name }}<span class="pill-count">({{ phenos | length }})</span></a>
                {% endfor %}
                <button class="pheno-toggle-all" id="phenoToggleAll">Expand all</button>
            </div>
            {# --- Collapsible groups --- #}
            {% for category_name, phenos in phenotype_groups %}
            <details class="phenotype-category-group" id="pheno-cat-{{ loop.index }}">
                <summary>
                    <svg class="chevron" viewBox="0 0 16 16" fill="currentColor"><path d="M6 3l5 5-5 5V3z"/></svg>
                    {{ category_name }}
                    <span class="cat-count">{{ phenos | length }}</span>
                </summary>
                {% for pheno in phenos %}
                <div class="item-box phenotype-box">
                    <div class="item-name">
                        {{ pheno.name }}
                        {% if pheno.frequency %}
                        <span class="phenotype-freq">{{ pheno.frequency }}</span>
                        {% endif %}
                        {% if pheno.phenotype_term and pheno.phenotype_term.term %}
                        <span class="phenotype-id">
                            <a href="{{ pheno.phenotype_term.term.id | curie_to_url }}" target="_blank">
                                {{ pheno.phenotype_term.term.label or pheno.phenotype_term.term.id }}
                            </a>
                            <span style="font-size: 0.72rem; color: var(--text-muted);">({{ pheno.phenotype_term.term.id }})</span>
                        </span>
                        {% endif %}
                    </div>
                    {% if pheno.notes %}
                    <div class="item-desc">{{ pheno.notes }}</div>
                    {% endif %}
                    {% if pheno.sequelae %}
                    <div class="item-meta">
                        <strong style="font-size: 0.8rem; color: #166534;">Sequelae:</strong>
                        {% for seq in pheno.sequelae %}
                        <span class="tag" style="background: #bbf7d0; color: #166534;">{{ seq.target }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                    {{ render_evidence(pheno.evidence) }}
                    {{ render_phenotype_contexts(pheno.phenotype_contexts) }}
                </div>
                {% endfor %}
            </details>
            {% endfor %}
            <script>
            (function() {
                // TOC pill click: expand target group and scroll to it
                document.querySelectorAll('.pheno-toc-pill').forEach(function(pill) {
                    pill.addEventListener('click', function() {
                        var target = document.getElementById(pill.dataset.target);
                        if (target) {
                            target.open = true;
                            target.scrollIntoView({behavior: 'smooth', block: 'start'});
                        }
                    });
                });
                // Expand/collapse all toggle
                var btn = document.getElementById('phenoToggleAll');
                if (btn) {
                    btn.addEventListener('click', function() {
                        var groups = document.querySelectorAll('.phenotype-category-group');
                        var anyOpen = Array.from(groups).some(function(g) { return g.open; });
                        groups.forEach(function(g) { g.open = !anyOpen; });
                        btn.textContent = anyOpen ? 'Expand all' : 'Collapse all';
                    });
                }
            })();
            </script>
            {% else %}
            {# --- Flat list fallback (single or no groups) --- #}
            {% for pheno in disorder.phenotypes %}
            <div class="item-box phenotype-box">
                <div class="item-name">
                    {{ pheno.name }}
                    {% if pheno.frequency %}
                    <span class="phenotype-freq">{{ pheno.frequency }}</span>
                    {% endif %}
                    {% if pheno.category %}
                    <span class="phenotype-category">{{ pheno.category }}</span>
                    {% endif %}
                    {% if pheno.phenotype_term and pheno.phenotype_term.term %}
                    <span class="phenotype-id">
                        <a href="{{ pheno.phenotype_term.term.id | curie_to_url }}" target="_blank">
                            {{ pheno.phenotype_term.term.id }}
                        </a>
                    </span>
                    {% endif %}
                </div>
                {% if pheno.notes %}
                <div class="item-desc">{{ pheno.notes }}</div>
                {% endif %}
                {% if pheno.sequelae %}
                <div class="item-meta">
                    <strong style="font-size: 0.8rem; color: #166534;">Sequelae:</strong>
                    {% for seq in pheno.sequelae %}
                    <span class="tag" style="background: #bbf7d0; color: #166534;">{{ seq.target }}</span>
                    {% endfor %}
                </div>
                {% endif %}
                {{ render_evidence(pheno.evidence) }}
                {{ render_phenotype_contexts(pheno.phenotype_contexts) }}
            </div>
            {% endfor %}
            {% endif %}
        </div>
        {% endif %}

        <!-- Genetic Associations -->
        {% if disorder.genetic %}
        <div class="card" id="genetic">
            <div class="card-header">
                <div class="card-icon" style="background: #dbeafe; color: #2563eb;">üß¨</div>
                <h2 class="card-title">Genetic Associations</h2>
                <span class="card-count">{{ disorder.genetic | length }}</span>
            </div>
            {% for gene in disorder.genetic %}
            <div class="item-box genetic-box">
                <div class="item-name">
                    {{ gene.name }}
                    {% if gene.association %}
                    <span style="font-size: 0.8rem; font-weight: normal; opacity: 0.8;">({{ gene.association }})</span>
                    {% endif %}
                </div>
                {% if gene.inheritance %}
                <div class="item-meta">
                    {% for inh in gene.inheritance %}
                    <span class="tag" style="background: #bfdbfe; color: #1e40af;">{{ inh.name }}</span>
                    {% endfor %}
                </div>
                {% endif %}
                {{ render_evidence(gene.evidence) }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Treatments -->
        {% if disorder.treatments %}
        <div class="card" id="treatments">
            <div class="card-header">
                <div class="card-icon" style="background: #ede9fe; color: #7c3aed;">üíä</div>
                <h2 class="card-title">Treatments</h2>
                <span class="card-count">{{ disorder.treatments | length }}</span>
            </div>
            {% for tx in disorder.treatments %}
            <div class="item-box treatment-box">
                <div class="item-name">
                    {{ tx.name }}
                    {% if tx.treatment_term and tx.treatment_term.term %}
                    <span class="phenotype-id">
                        <a href="{{ tx.treatment_term.term.id | curie_to_url }}" target="_blank">
                            {{ tx.treatment_term.term.id }}
                        </a>
                    </span>
                    {% endif %}
                </div>
                {% if tx.treatment_term and tx.treatment_term.therapeutic_agent %}
                <div class="item-meta">
                    <strong style="font-size: 0.8rem; color: #5b21b6;">Drug:</strong>
                    {% for agent in tx.treatment_term.therapeutic_agent %}
                    <span class="tag tag-treatment">
                        {{ agent.preferred_term or agent.term.label }}
                        {% if agent.term and agent.term.id %}
                        <a href="{{ agent.term.id | curie_to_url }}" target="_blank" style="color: inherit; margin-left: 4px;">‚Üó</a>
                        {% endif %}
                    </span>
                    {% endfor %}
                </div>
                {% endif %}
                {% if tx.description %}
                <div class="item-desc">{{ tx.description }}</div>
                {% endif %}
                {% if tx.target_mechanisms %}
                <div class="item-meta" style="margin-top: 8px;">
                    <strong style="font-size: 0.8rem; color: #7c3aed;">Mechanism Target:</strong>
                    {% for tm in tx.target_mechanisms %}
                    <div style="margin: 4px 0 4px 12px; font-size: 0.88rem;">
                        <span class="tag" style="background: #f3e8ff; color: #6b21a8; font-size: 0.8rem;">
                            {{ tm.treatment_effect }}
                        </span>
                        <strong style="color: #5b21b6;">{{ tm.target }}</strong>
                        {% if tm.description %}
                        <span style="color: #7c3aed;"> &mdash; {{ tm.description }}</span>
                        {% endif %}
                        {{ render_evidence(tm.evidence) }}
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
                {% if tx.target_phenotypes %}
                <div class="item-meta" style="margin-top: 8px;">
                    <strong style="font-size: 0.8rem; color: #6b21a8;">Target Phenotypes:</strong>
                    {% for pheno in tx.target_phenotypes %}
                    <span class="tag" style="background: #ede9fe; color: #6b21a8; font-size: 0.8rem;">
                        {{ pheno.preferred_term or pheno.term.label }}
                        {% if pheno.term and pheno.term.id %}
                        <a href="{{ pheno.term.id | curie_to_url }}" target="_blank" style="color: inherit; margin-left: 4px;">‚Üó</a>
                        {% endif %}
                    </span>
                    {% endfor %}
                </div>
                {% endif %}
                {{ render_evidence(tx.evidence) }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Environmental Factors -->
        {% if disorder.environmental %}
        <div class="card">
            <div class="card-header">
                <div class="card-icon" style="background: #ccfbf1; color: #0d9488;">üåç</div>
                <h2 class="card-title">Environmental Factors</h2>
                <span class="card-count">{{ disorder.environmental | length }}</span>
            </div>
            {% for env in disorder.environmental %}
            <div class="item-box environmental-box">
                <div class="item-name">{{ env.name }}</div>
                {% if env.notes %}
                <div class="item-desc">{{ env.notes }}</div>
                {% endif %}
                {% if env.description %}
                <div class="item-desc">{{ env.description }}</div>
                {% endif %}
                {{ render_evidence(env.evidence) }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Biochemical Markers -->
        {% if disorder.biochemical %}
        <div class="card">
            <div class="card-header">
                <div class="card-icon" style="background: #fef3c7; color: #d97706;">üî¨</div>
                <h2 class="card-title">Biochemical Markers</h2>
                <span class="card-count">{{ disorder.biochemical | length }}</span>
            </div>
            {% for bio in disorder.biochemical %}
            <div class="item-box biochemical-box">
                <div class="item-name">
                    {{ bio.name }}
                    {% if bio.presence %}
                    <span style="font-size: 0.8rem; font-weight: normal; opacity: 0.8;">({{ bio.presence }})</span>
                    {% endif %}
                </div>
                {% if bio.context %}
                <div class="item-desc">Context: {{ bio.context }}</div>
                {% endif %}
                {{ render_evidence(bio.evidence) }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Differential Diagnoses -->
        {% if disorder.differential_diagnoses %}
        <div class="card" id="differentials">
            <div class="card-header">
                <div class="card-icon" style="background: #fef2f2; color: #dc2626;">üîÄ</div>
                <h2 class="card-title">Differential Diagnoses</h2>
                <span class="card-count">{{ disorder.differential_diagnoses | length }}</span>
            </div>
            <p style="margin-bottom: 16px; font-size: 0.95rem; color: var(--text-muted);">
                Conditions with similar clinical presentations that must be differentiated from {{ disorder.name }}:
            </p>
            {% for diff in disorder.differential_diagnoses %}
            <div class="item-box differential-box">
                <div class="item-name">
                    {{ diff.name }}
                    {% if diff.disease_term and diff.disease_term.term %}
                    <span class="phenotype-id">
                        <a href="{{ diff.disease_term.term.id | curie_to_url }}" target="_blank">
                            {{ diff.disease_term.term.id }}
                        </a>
                    </span>
                    {% endif %}
                </div>
                {% if diff.description %}
                <div class="differential-similarities">
                    <strong>Overlapping Features</strong>
                    {{ diff.description }}
                </div>
                {% endif %}
                {% if diff.distinguishing_features %}
                <div class="differential-distinctions">
                    <strong>Distinguishing Features</strong>
                    {% if diff.distinguishing_features is string %}
                    {{ diff.distinguishing_features }}
                    {% else %}
                    <ul>
                        {% for feature in diff.distinguishing_features %}
                        <li>{{ feature }}</li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                </div>
                {% endif %}
                {{ render_evidence(diff.evidence) }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Datasets -->
        {% if disorder.datasets %}
        <div class="card" id="datasets">
            <div class="card-header">
                <div class="card-icon" style="background: #e0f2fe; color: #0284c7;">üìä</div>
                <h2 class="card-title">Related Datasets</h2>
                <span class="card-count">{{ disorder.datasets | length }}</span>
            </div>
            {% for ds in disorder.datasets %}
            <div class="item-box dataset-box">
                <div class="item-name">
                    {{ ds.title }}
                    {% if ds.accession %}
                    <span class="dataset-accession">
                        <a href="{{ ds.accession | curie_to_url }}" target="_blank">{{ ds.accession }}</a>
                    </span>
                    {% endif %}
                </div>
                {% if ds.description %}
                <div class="item-desc">{{ ds.description }}</div>
                {% endif %}
                <div class="item-meta">
                    {% if ds.organism and ds.organism.preferred_term %}
                    <span class="tag tag-organism">{{ ds.organism.preferred_term }}</span>
                    {% endif %}
                    {% if ds.data_type %}
                    <span class="tag tag-datatype">{{ ds.data_type | replace('_', ' ') }}</span>
                    {% endif %}
                    {% if ds.sample_count %}
                    <span class="tag tag-dataset">n={{ ds.sample_count }}</span>
                    {% endif %}
                    {% if ds.platform %}
                    <span class="tag" style="background: #f1f5f9; color: #475569;">{{ ds.platform | truncate(40) }}</span>
                    {% endif %}
                </div>
                {% if ds.sample_types %}
                <div class="item-meta" style="margin-top: 6px;">
                    {% for st in ds.sample_types %}
                    <span class="tag tag-cell">
                        {{ st.preferred_term }}
                        {% if st.cell_type_term and st.cell_type_term.term and st.cell_type_term.term.id %}
                        <a href="{{ st.cell_type_term.term.id | curie_to_url }}" target="_blank" class="linkout">link</a>
                        {% endif %}
                    </span>
                    {% endfor %}
                </div>
                {% endif %}
                {% if ds.conditions %}
                <div class="item-meta" style="margin-top: 6px;">
                    <strong style="font-size: 0.8rem; color: #0369a1;">Conditions:</strong>
                    {% for cond in ds.conditions %}
                    <span class="tag" style="background: #f0f9ff; color: #0369a1; font-size: 0.8rem;">{{ cond }}</span>
                    {% endfor %}
                </div>
                {% endif %}
                {% if ds.exposures %}
                <div class="item-meta" style="margin-top: 6px;">
                    <strong style="font-size: 0.8rem; color: #0d9488;">Exposures:</strong>
                    {% for exp in ds.exposures %}
                    <span class="tag tag-env">
                        {{ exp.preferred_term }}
                        {% if exp.term and exp.term.id %}
                        <a href="{{ exp.term.id | curie_to_url }}" target="_blank" class="linkout">link</a>
                        {% endif %}
                    </span>
                    {% endfor %}
                </div>
                {% endif %}
                {{ render_findings(ds.findings) }}
                {% if ds.publication %}
                <div style="margin-top: 8px; font-size: 0.85rem;">
                    <a href="{{ ds.publication | curie_to_url }}" target="_blank" style="color: var(--secondary);">{{ ds.publication }}</a>
                </div>
                {% endif %}
                {% if ds.notes %}
                <div class="item-desc" style="margin-top: 8px; font-style: italic;">{{ ds.notes }}</div>
                {% endif %}
                {{ render_evidence(ds.evidence) }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Clinical Trials -->
        {% if disorder.clinical_trials %}
        <div class="card" id="trials">
            <div class="card-header">
                <div class="card-icon" style="background: #f5f3ff; color: #a855f7;">üî¨</div>
                <h2 class="card-title">Clinical Trials</h2>
                <span class="card-count">{{ disorder.clinical_trials | length }}</span>
            </div>
            {% for trial in disorder.clinical_trials %}
            <div class="item-box clinical-trial-box">
                <div class="item-name">
                    {{ trial.name }}
                    {% if trial.phase %}
                    <span class="tag tag-phase">{{ trial.phase }}</span>
                    {% endif %}
                    {% if trial.status %}
                    <span class="tag tag-status">{{ trial.status }}</span>
                    {% endif %}
                </div>
                {% if trial.description %}
                <div class="item-desc">{{ trial.description }}</div>
                {% endif %}
                {% if trial.target_phenotypes %}
                <div class="item-meta">
                    <strong style="font-size: 0.8rem; color: #6b21a8;">Target Phenotypes:</strong>
                    {% for pheno in trial.target_phenotypes %}
                    <span class="tag" style="background: #ede9fe; color: #6b21a8; font-size: 0.8rem;">
                        {{ pheno.preferred_term or pheno.term.label }}
                        {% if pheno.term and pheno.term.id %}
                        <a href="{{ pheno.term.id | curie_to_url }}" target="_blank" style="color: inherit; margin-left: 4px;">‚Üó</a>
                        {% endif %}
                    </span>
                    {% endfor %}
                </div>
                {% endif %}
                {{ render_evidence(trial.evidence) }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- YAML Source -->
        <div class="card">
            <div class="card-header" style="cursor: pointer;" onclick="toggleYaml()">
                <div class="card-icon" style="background: #f1f5f9; color: #475569;">{ }</div>
                <h2 class="card-title">Source YAML</h2>
                <span class="card-count" id="yamlToggleText">click to show</span>
            </div>
            <div class="yaml-content" id="yamlContent">
                <pre class="yaml-preview">{{ yaml_content }}</pre>
            </div>
        </div>

        <footer class="page-footer">
            <p>
                Generated from <a href="https://github.com/monarch-initiative/dismech" target="_blank">dismech</a>
                knowledge base
            </p>
            <p style="margin-top: 8px;">
                <a href="{{ source_file }}" target="_blank">View source on GitHub</a>
            </p>
        </footer>
    </div>

    <script>
        function toggleYaml() {
            const content = document.getElementById('yamlContent');
            const toggleText = document.getElementById('yamlToggleText');
            content.classList.toggle('show');
            toggleText.textContent = content.classList.contains('show') ? 'click to hide' : 'click to show';
        }
    </script>
    <script>
        (function() {
            const banner = document.querySelector('.notice-banner');
            if (!banner) return;
            const dismiss = () => banner.remove();
            banner.addEventListener('click', dismiss);
            banner.addEventListener('keydown', (event) => {
                if (event.key === 'Enter' || event.key === ' ') {
                    event.preventDefault();
                    dismiss();
                }
            });
        })();
    </script>
</body>
</html>
