id: https://w3id.org/monarch-initiative/dismech/matching
name: matching
title: DisMech Phenotype Matching Schema
description: >-
  Schema for deterministic case-to-disease phenotype matching outputs.
  Input is a case phenotype set and a single dismech disease slug.
license: BSD-3-Clause

imports:
  - linkml:types

prefixes:
  linkml: https://w3id.org/linkml/
  matching: https://w3id.org/monarch-initiative/dismech/matching/

default_prefix: matching
default_range: string

enums:
  FrequencyEnum:
    description: Frequency of a phenotype in the disease model
    permissible_values:
      OBLIGATE:
        description: Obligate
      VERY_FREQUENT:
        description: Very frequent
      FREQUENT:
        description: Frequent
      OCCASIONAL:
        description: Occasional
      VERY_RARE:
        description: Very rare

slots:
  run_id:
    description: Unique identifier for this matching run
    range: string
    required: true
  case_id:
    description: Identifier for the input case
    range: string
    required: true
  disease_slug:
    description: DisMech disease slug used as the target model
    range: string
    required: true
  generated_at:
    description: UTC timestamp for when the run was generated
    range: datetime
  explanations:
    description: Reusable explanations referenced by match-level explanation pointers
    multivalued: true
    inlined_as_list: true
    range: MatchingExplanation
  pr_is_diagnosis:
    description: Product of probabilities for unique explanation IDs referenced by explanation_for_no_match
    range: float
    required: true
    minimum_value: 0
    maximum_value: 1
  matches:
    description: Matching rows keyed by a case phenotype, a model phenotype, or both
    multivalued: true
    inlined_as_list: true
    range: MatchingRow
    required: true

  case_term_id:
    description: Case phenotype identifier, typically an HPO CURIE (optional for model-only rows)
    range: string
  case_label:
    description: Label for the case phenotype term
    range: string
  case_description:
    description: Optional free-text description for the case phenotype
    range: string
  case_present:
    description: True for observed phenotypes, false for negated phenotypes (optional for model-only rows)
    range: boolean

  model_term_id:
    description: Matched phenotype identifier from the disease model
    range: string
  model_label:
    description: Label for the matched disease model phenotype term
    range: string
  model_description:
    description: Description text for the matched disease model phenotype
    range: string
  model_frequency:
    description: Frequency annotation for the matched disease model phenotype
    range: FrequencyEnum

  exact:
    description: True when case term and model term are the same concept
    range: boolean
    required: true
  case_is_broader:
    description: True when case term is broader than the model term
    range: boolean
    required: true
  case_is_narrower:
    description: True when case term is narrower than the model term
    range: boolean
    required: true
  case_is_close:
    description: True when terms are close but not in broader/narrower relation
    range: boolean
    required: true

  similarity_percent:
    description: Semantic similarity score from 0 to 100
    range: float
    minimum_value: 0
    maximum_value: 100
  explanation_for_no_match:
    description: Optional pointer to a shared explanation for why this row is not matched
    range: MatchingExplanation
    inlined: false
  estimated_probability:
    description: Estimated probability for a shared explanation from 0.0 to 1.0
    range: float
    required: true
    minimum_value: 0
    maximum_value: 1
  description:
    description: Human-readable explanation text
    range: string
    required: true

classes:
  MatchingRun:
    description: Full output for one case against one disease slug
    tree_root: true
    slots:
      - run_id
      - case_id
      - disease_slug
      - generated_at
      - explanations
      - pr_is_diagnosis
      - matches

  MatchingRow:
    description: Matching result for one phenotype row on either case side, model side, or both
    slots:
      - case_term_id
      - case_label
      - case_description
      - case_present
      - model_term_id
      - model_label
      - model_description
      - model_frequency
      - exact
      - case_is_broader
      - case_is_narrower
      - case_is_close
      - similarity_percent
      - explanation_for_no_match

  MatchingExplanation:
    description: Reusable explanation that can be referenced by multiple matching rows
    slots:
      - explanation_id
      - estimated_probability
      - description
    slot_usage:
      explanation_id:
        identifier: true
        required: true
